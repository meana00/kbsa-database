<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한국 초자연 현상 관리국</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #111827; /* Dark Gray */
            color: #E5E7EB; /* Light Gray */
        }
        .header-glitch { animation: glitch 1s linear infinite; }
        @keyframes glitch {
            2%,64% { transform: translate(2px,0) skew(0deg); }
            4%,60% { transform: translate(-2px,0) skew(0deg); }
            62% { transform: translate(0,0) skew(5deg); }
        }
        .header-glitch:before, .header-glitch:after { content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #111827; overflow: hidden; }
        .header-glitch:before { left: 2px; text-shadow: -2px 0 #ff00c1; clip: rect(44px, 450px, 56px, 0); animation: glitch-anim 5s infinite linear alternate-reverse; }
        .header-glitch:after { left: -2px; text-shadow: -2px 0 #00fff9, 2px 2px #ff00c1; clip: rect(85px, 450px, 90px, 0); animation: glitch-anim2 5s infinite linear alternate-reverse; }
        @keyframes glitch-anim { 0% { clip: rect(42px, 9999px, 44px, 0); } 10% { clip: rect(17px, 9999px, 96px, 0); } 20% { clip: rect(50px, 9999px, 52px, 0); } 30% { clip: rect(25px, 9999px, 70px, 0); } 40% { clip: rect(40px, 9999px, 62px, 0); } 50% { clip: rect(25px, 9999px, 100px, 0); } 60% { clip: rect(65px, 9999px, 80px, 0); } 70% { clip: rect(10px, 9999px, 45px, 0); } 80% { clip: rect(80px, 9999px, 100px, 0); } 90% { clip: rect(20px, 9999px, 75px, 0); } 100% { clip: rect(55px, 9999px, 60px, 0); } }
        @keyframes glitch-anim2 { 0% { clip: rect(15px, 9999px, 99px, 0); } 10% { clip: rect(33px, 9999px, 72px, 0); } 20% { clip: rect(60px, 9999px, 42px, 0); } 30% { clip: rect(45px, 9999px, 80px, 0); } 40% { clip: rect(70px, 9999px, 52px, 0); } 50% { clip: rect(35px, 9999px, 90px, 0); } 60% { clip: rect(75px, 9999px, 70px, 0); } 70% { clip: rect(20px, 9999px, 55px, 0); } 80% { clip: rect(90px, 9999px, 100px, 0); } 90% { clip: rect(40px, 9999px, 85px, 0); } 100% { clip: rect(65px, 9999px, 70px, 0); } }
        .scanlines { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.05)); background-size: 100% 4px; animation: scan 2s linear infinite; }
        @keyframes scan { 0% { background-position: 0 0; } 100% { background-position: 0 100px; } }
        .object-card { border: 1px solid #374151; transition: all 0.3s ease; }
        .object-card:hover { border-color: #F87171; box-shadow: 0 0 15px rgba(248, 113, 113, 0.5); transform: translateY(-5px); }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">
    <div class="scanlines"></div>
    <div class="container mx-auto p-4 md:p-8">

        <!-- 헤더 -->
        <header class="text-center mb-12 relative">
            <div class="inline-block p-4 border-2 border-red-500 rounded-lg">
                <h1 class="text-4xl md:text-6xl font-bold text-red-400 tracking-widest relative header-glitch" data-text="KBSA">KBSA</h1>
                <p class="text-lg md:text-xl text-gray-400 mt-2">한국 초자연 현상 관리국</p>
                <p class="text-xs text-gray-500">Korea Bureau of Supernatural Affairs</p>
                <p class="text-sm text-yellow-500 mt-2">[보안 등급: 3등급 인가자]</p>
            </div>
        </header>

        <!-- 네비게이션 -->
        <nav class="bg-gray-800 border border-gray-700 rounded-lg p-4 mb-12 flex justify-center items-center space-x-4 md:space-x-8">
            <a href="#welcome" class="text-gray-300 hover:text-red-400 transition">홈</a>
            <a href="#objects" class="text-gray-300 hover:text-red-400 transition">관리 개체 목록</a>
            <a href="#about" class="text-gray-300 hover:text-red-400 transition">부서 정보</a>
            <button id="addNewReportBtnNav" onclick="openNewReportModal()" class="text-gray-300 hover:text-red-400 transition hidden">신규 보고서 추가</button>
            <button id="adminLoginBtn" onclick="handleAdminClick()" class="text-yellow-400 hover:text-yellow-200 transition border border-yellow-500 px-3 py-1 rounded-md text-sm">관리자 모드</button>
        </nav>

        <!-- 메인 컨텐츠 -->
        <main id="main-content">
            <section id="welcome" class="bg-gray-800 border border-gray-700 rounded-lg p-6 mb-8">
                <h2 id="briefing-date" class="text-2xl font-bold text-red-400 border-b-2 border-red-500 pb-2 mb-4">보안 브리핑: 2025-09-06</h2>
                <p class="mb-4">3등급 인가자, 환영합니다. 본 데이터베이스는 대한민국 영토 내에서 발견 및 관리 중인 초자연적 개체, 현상, 유물에 대한 정보를 포함하고 있습니다. 모든 정보는 <span class="text-yellow-400 font-bold">1급 기밀</span>로 취급되며, 허가되지 않은 접근, 복사, 외부 유출은 국가보안법 및 관리국 내규에 의거하여 엄중히 처벌됩니다.</p>
            </section>

            <section id="objects">
                <div class="flex justify-between items-center mb-8">
                     <h2 class="text-3xl font-bold text-gray-300">주요 관리 개체 목록</h2>
                     <button id="addNewEntityBtnMain" onclick="openNewReportModal()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition hidden">+ 신규 개체 등록</button>
                </div>
                <div id="object-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </section>
            
            <section id="about" class="bg-gray-800 border border-gray-700 rounded-lg p-6 mt-12">
                <h2 class="text-2xl font-bold text-red-400 border-b-2 border-red-500 pb-2 mb-4">우리의 임무</h2>
                <p><strong>"우리는 어둠 속에서 싸우며, 빛을 지키기 위해 존재한다."</strong></p>
            </section>
        </main>

        <footer class="text-center text-gray-500 text-sm mt-12 border-t border-gray-700 pt-6">
            <p>&copy; 2025 대한민국 정부. 모든 권리 보유.</p>
        </footer>
    </div>

    <!-- 모달 컨테이너 -->
    <div id="reportModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50"><div class="bg-gray-800 border border-red-500 rounded-lg p-8 max-w-3xl w-full max-h-screen overflow-y-auto relative"><button onclick="closeModal('reportModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">&times;</button><div id="reportContent"></div></div></div>
    <div id="formModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50"><div class="bg-gray-800 border border-yellow-500 rounded-lg p-8 max-w-2xl w-full relative"><h2 id="formTitle" class="text-2xl font-bold text-yellow-400 mb-6"></h2><button onclick="closeModal('formModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">&times;</button><form id="reportForm"><input type="hidden" id="editObjectId" name="editObjectId"><div class="mb-4"><label for="objectId" class="block text-sm font-bold mb-2">개체 번호</label><input type="text" id="objectId" name="objectId" class="w-full bg-gray-700 border border-gray-600 rounded py-2 px-3 focus:outline-none focus:border-yellow-500" required></div><div class="mb-4"><label for="objectAlias" class="block text-sm font-bold mb-2">별칭</label><input type="text" id="objectAlias" name="objectAlias" class="w-full bg-gray-700 border border-gray-600 rounded py-2 px-3 focus:outline-none focus:border-yellow-500" required></div><div class="mb-4"><label for="objectLevel" class="block text-sm font-bold mb-2">위험 등급</label><select id="objectLevel" name="objectLevel" class="w-full bg-gray-700 border border-gray-600 rounded py-2 px-3 focus:outline-none focus:border-yellow-500" required><option value="안전">안전</option><option value="경계">경계</option><option value="위험">위험</option><option value="미분류">미분류</option></select></div><div class="mb-6"><label for="objectDescription" class="block text-sm font-bold mb-2">개요</label><textarea id="objectDescription" name="objectDescription" rows="3" class="w-full bg-gray-700 border border-gray-600 rounded py-2 px-3 focus:outline-none focus:border-yellow-500" required></textarea></div><div class="text-right"><button type="button" onclick="closeModal('formModal')" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg mr-2 transition">취소</button><button type="submit" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition">제출</button></div></form></div></div>
    <div id="passwordModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50"><div class="bg-gray-800 border border-yellow-500 rounded-lg p-8 max-w-sm w-full"><h2 class="text-xl font-bold text-yellow-400 mb-4">관리자 인증</h2><p id="passwordError" class="text-red-500 text-sm mb-4 hidden">비밀번호가 틀렸습니다.</p><input type="password" id="passwordInput" class="w-full bg-gray-700 border border-gray-600 rounded py-2 px-3 mb-4 focus:outline-none focus:border-yellow-500" placeholder="비밀번호"><div class="text-right"><button type="button" onclick="closeModal('passwordModal')" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg mr-2 transition">취소</button><button type="button" onclick="checkPassword()" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg transition">인증</button></div></div></div>
    <div id="deleteConfirmModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50"><div class="bg-gray-800 border border-red-500 rounded-lg p-8 max-w-sm w-full"><h2 class="text-xl font-bold text-red-400 mb-4">삭제 확인</h2><p id="deleteConfirmText" class="mb-6"></p><div class="text-right"><button type="button" onclick="closeModal('deleteConfirmModal')" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg mr-2 transition">취소</button><button type="button" onclick="confirmDelete()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition">삭제</button></div></div></div>
    <div id="logFormModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50"><div class="bg-gray-800 border border-green-500 rounded-lg p-8 max-w-xl w-full relative"><h2 id="logFormTitle" class="text-2xl font-bold text-green-400 mb-6"></h2><button onclick="closeModal('logFormModal')" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">&times;</button><form id="logForm"><input type="hidden" id="logObjectId"><input type="hidden" id="logId"><div class="mb-4"><label for="logAgent" class="block text-sm font-bold mb-2">요원 이름</label><input type="text" id="logAgent" class="w-full bg-gray-700 border border-gray-600 rounded py-2 px-3" required></div><div class="mb-6"><label for="logContent" class="block text-sm font-bold mb-2">기록 내용</label><textarea id="logContentInput" rows="4" class="w-full bg-gray-700 border border-gray-600 rounded py-2 px-3" required></textarea></div><div class="text-right"><button type="button" onclick="closeModal('logFormModal')" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg mr-2">취소</button><button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">기록 저장</button></div></form></div></div>

    <script>
        // --- 상태 관리 ---
        let adminMode = false;
        let itemToDelete = { type: null, objectId: null, logId: null };

        // --- 데이터베이스 ---
        let objects = [
            {
                id: "BSA-001-492-771", alias: "돌아오지 않는 놀이터", level: "안전", description: "경기도 외곽에 위치한 특정 놀이터. 일몰 후 특정 조건에서 진입한 아동이 실종되는 현상. 현재 제3기동대에 의해 격리 조치 완료.",
                specialProcedures: "대상 놀이터는 KBSA 제17기지 소속 제3기동대 '땅거미'가 관리한다. 반경 2km 이내에 3단계 보안 경계가 설정되었으며, 민간인 접근은 '군사 훈련 구역'으로 위장하여 통제한다.",
                details: "BSA-001은 경기도 ██시 외곽에 위치한 낡은 어린이 놀이터이다. 미끄럼틀, 그네, 시소로 구성된 평범한 놀이터의 모습을 하고 있으나, 일몰 후 특정 천문학적 조건(███ ██ 현상)이 충족될 때 변칙성이 발현된다.",
                appendix: "부록 001-A: 탐사 기록 D-34가 회수한 녹음 파일에는 '엄마, 여긴 별이 모래처럼 많아.' 라는 알 수 없는 음성이 기록되어 있었다.",
                logs: [ { logId: 1662454123456, date: "2025-07-15", agent: "김민준 요원", content: "초기 격리 절차 완료. 변칙성 발현 조건 재확인 필요." }, { logId: 1662454123457, date: "2025-08-02", agent: "박서연 요원", content: "D-34 탐사 드론 투입. 미지의 음성 신호 포착." } ]
            },
            {
                id: "BSA-002-108-345", alias: "웃는 얼굴의 도자기", level: "경계", description: "조선시대 백자로 추정되는 유물. 반경 5m 내의 인간에게 강박적인 행복감을 유발하며, 장기 노출 시 감정 체계를 영구적으로 손상시킴.",
                specialProcedures: "BSA-002는 제7기지 제3생물연구동의 전자기 차폐 격리실에 보관한다. 대상과 관련된 모든 실험은 D등급 인원을 통해서만 진행하며, 노출 시간은 최대 10분을 넘지 않도록 엄격히 통제한다.",
                details: "BSA-002는 16세기 조선 백자로 추정되는 높이 30cm의 도자기이다. 표면에는 어린 아이의 웃는 얼굴이 음각으로 새겨져 있다. 대상은 반경 5m 이내의 지성을 가진 존재에게 강력한 행복감과 도취감을 유발하는 정신 감응파를 방출한다.",
                logs: [ { logId: 1662454123458, date: "2025-08-20", agent: "이현우 박사", content: "정신 감응파의 정확한 주파수 측정 실패. 더 정밀한 장비 요청." } ]
            },
            {
                id: "BSA-003-881-213", alias: "스스로 쓰는 붓", level: "위험", description: "소유자의 의지와 무관하게 미래의 재앙을 예언하는 서예를 쓴다. 예언 내용은 100%의 정확도를 보이며, 예언을 막으려는 시도는 더 큰 재앙을 초래함.",
                specialProcedures: "BSA-003은 제3기지 최고 보안 등급의 무인 격리실에 보관한다. 격리실에는 항상 최고급 화선지와 먹물이 공급되어야 한다. 붓이 쓴 예언은 원격 로봇 팔에 의해 즉시 수거되어 4등급 이상의 연구원에게 전달된다.",
                details: "BSA-003은 제작자 및 제작 연대 미상의 붓이다. 살아있는 인간이 붓을 잡으면, 소유자의 의지와 상관없이 붓이 스스로 움직여 미래에 발생할 재앙을 서예 형태로 기록한다. 20██년, '██ 대교 붕괴' 예언을 막으려다 더 큰 피해가 발생한 이후 '관측만 가능한' 개체로 재분류되었다.",
                logs: []
            }
        ];
        
        // --- DOM 요소 ---
        const objectListContainer = document.getElementById('object-list');
        const reportModal = document.getElementById('reportModal');
        const formModal = document.getElementById('formModal');
        const passwordModal = document.getElementById('passwordModal');
        const deleteConfirmModal = document.getElementById('deleteConfirmModal');
        const logFormModal = document.getElementById('logFormModal');
        const reportContent = document.getElementById('reportContent');
        const reportForm = document.getElementById('reportForm');
        const logForm = document.getElementById('logForm');
        
        // --- 렌더링 함수 ---
        function getLevelColor(level) {
            return { '안전': 'bg-green-800 text-green-200', '경계': 'bg-yellow-800 text-yellow-200', '위험': 'bg-red-800 text-red-200' }[level] || 'bg-gray-700 text-gray-200';
        }

        function renderObjects() {
            objectListContainer.innerHTML = objects.map(obj => {
                const adminButtons = adminMode ? `
                    <div class="mt-4 pt-4 border-t border-gray-700 flex justify-end space-x-2">
                        <button onclick="openEditReportModal('${obj.id}')" class="text-sm bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded">수정</button>
                        <button onclick="openDeleteConfirm('object', '${obj.id}')" class="text-sm bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded">삭제</button>
                    </div>` : '';
                return `
                    <div class="object-card bg-gray-800 rounded-lg p-6 flex flex-col justify-between">
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-xl font-bold text-red-400">${obj.id}</h3>
                                <span class="px-3 py-1 ${getLevelColor(obj.level)} text-sm font-semibold rounded-full">${obj.level}</span>
                            </div>
                            <p class="text-gray-400 text-sm mb-4"><strong>별칭: ${obj.alias}.</strong> ${obj.description}</p>
                        </div>
                        <div>
                            <button onclick="viewReport('${obj.id}')" class="text-red-400 hover:underline text-left">세부 보고서 열람 &raquo;</button>
                            ${adminButtons}
                        </div>
                    </div>`;
            }).join('');
        }

        function viewReport(objectId) {
            const object = objects.find(obj => obj.id === objectId);
            if (!object) return;

            const reportHTML = `
                <h3 class="text-2xl font-bold text-red-400 mb-1">개체 번호: ${object.id}</h3>
                <p class="text-lg text-gray-400 mb-4"><strong>등급:</strong> ${object.level}</p>
                <hr class="border-gray-600 my-4">
                <p class="mb-2"><strong>특수 격리 절차:</strong> ${object.specialProcedures || '기록 없음.'}</p>
                <p class="mb-2"><strong>설명:</strong> ${object.details || '기록 없음.'}</p>
                ${object.appendix ? `<p class="font-bold mt-4 text-yellow-400">${object.appendix}</p>` : ''}
                
                <hr class="border-gray-600 my-8">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-xl font-bold text-gray-300">탐사 기록</h4>
                    ${adminMode ? `<button onclick="openNewLogModal('${object.id}')" class="bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-3 rounded text-sm">+ 기록 추가</button>` : ''}
                </div>
                <div class="space-y-4">
                ${object.logs && object.logs.length > 0 ? object.logs.map(log => `
                    <div class="bg-gray-900 p-3 rounded-lg border border-gray-700">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-semibold text-gray-400">${log.agent} - <span class="text-xs font-normal">${log.date}</span></p>
                                <p class="text-gray-300 mt-1">${log.content}</p>
                            </div>
                            ${adminMode ? `
                            <div class="flex space-x-2 flex-shrink-0 ml-4">
                                <button onclick="openEditLogModal('${object.id}', ${log.logId})" class="text-xs text-blue-400 hover:underline">수정</button>
                                <button onclick="openDeleteConfirm('log', '${object.id}', ${log.logId})" class="text-xs text-red-400 hover:underline">삭제</button>
                            </div>` : ''}
                        </div>
                    </div>`).join('') : '<p class="text-gray-500">기록된 탐사 기록이 없습니다.</p>'}
                </div>`;
            
            reportContent.innerHTML = reportHTML;
            reportModal.classList.remove('hidden');
        }

        // --- 모달 관리 ---
        function closeModal(modalId) { document.getElementById(modalId).classList.add('hidden'); }
        
        function openNewReportModal() {
            if (!adminMode) return; // 관리자 모드에서만 실행
            document.getElementById('formTitle').textContent = '신규 개체 보고서 등록';
            reportForm.reset();
            document.getElementById('editObjectId').value = '';
            formModal.classList.remove('hidden');
        }
        
        function openEditReportModal(objectId) {
            const object = objects.find(obj => obj.id === objectId);
            if (!object) return;
            document.getElementById('formTitle').textContent = '개체 보고서 수정';
            Object.keys(object).forEach(key => {
                const el = document.getElementById(`object${key.charAt(0).toUpperCase() + key.slice(1)}`);
                if (el) el.value = object[key];
            });
            document.getElementById('objectId').value = object.id; // manual set for id
            document.getElementById('editObjectId').value = object.id;
            formModal.classList.remove('hidden');
        }

        // --- 개체 관리 ---
        reportForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const editId = formData.get('editObjectId');
            const objectData = {
                id: formData.get('objectId'),
                alias: formData.get('objectAlias'),
                level: formData.get('objectLevel'),
                description: formData.get('objectDescription'),
            };

            if (editId) {
                const index = objects.findIndex(obj => obj.id === editId);
                if (index !== -1) {
                    objects[index] = { ...objects[index], ...objectData };
                }
            } else {
                objectData.logs = []; // Add empty logs for new object
                objects.push(objectData);
            }
            renderObjects();
            closeModal('formModal');
        });

        // --- 탐사 기록 관리 ---
        function openNewLogModal(objectId) {
// ... existing code ... -->
            logFormModal.classList.remove('hidden');
        }

        function openEditLogModal(objectId, logId) {
// ... existing code ... -->
            logFormModal.classList.remove('hidden');
        }
        
        logForm.addEventListener('submit', function(e) {
// ... existing code ... -->
            closeModal('logFormModal');
            viewReport(objectId); // 모달 내용 새로고침
        });

        // --- 관리자 및 삭제 기능 ---
        function handleAdminClick() {
            if (adminMode) {
                // 관리자 모드가 활성화된 경우, 로그아웃 처리
                adminMode = false;
                const btn = document.getElementById('adminLoginBtn');
                btn.textContent = '관리자 모드';
                btn.classList.replace('border-green-500', 'border-yellow-500');
                btn.classList.replace('text-green-400', 'text-yellow-400');
                document.getElementById('addNewReportBtnNav').classList.add('hidden');
                document.getElementById('addNewEntityBtnMain').classList.add('hidden');
                renderObjects(); // 관리 버튼을 숨기기 위해 목록을 다시 렌더링
                // 세부 보고서 모달이 열려있다면 닫아서 이전 관리자 UI가 남지 않도록 함
                if (!reportModal.classList.contains('hidden')) {
                    closeModal('reportModal');
                }
            } else {
                // 관리자 모드가 비활성화된 경우, 비밀번호 모달을 염
                openPasswordModal();
            }
        }

        function openPasswordModal() {
            document.getElementById('passwordError').classList.add('hidden');
            document.getElementById('passwordInput').value = '';
            passwordModal.classList.remove('hidden');
        }

        function checkPassword() {
            if (document.getElementById('passwordInput').value === '2923') {
                adminMode = true;
                closeModal('passwordModal');
                const btn = document.getElementById('adminLoginBtn');
                btn.textContent = '관리자 모드 활성';
                btn.classList.replace('border-yellow-500', 'border-green-500');
                btn.classList.replace('text-yellow-400', 'text-green-400');
                document.getElementById('addNewReportBtnNav').classList.remove('hidden');
                document.getElementById('addNewEntityBtnMain').classList.remove('hidden');
                renderObjects();
            } else {
                document.getElementById('passwordError').classList.remove('hidden');
            }
        }

        function openDeleteConfirm(type, objectId, logId = null) {
            itemToDelete = { type, objectId, logId };
            const text = type === 'object' ? `개체 [${objectId}] 보고서 전체를` : `[${objectId}] 보고서의 탐사 기록을`;
            document.getElementById('deleteConfirmText').textContent = `정말로 ${text} 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.`;
            deleteConfirmModal.classList.remove('hidden');
        }

        function confirmDelete() {
            const { type, objectId, logId } = itemToDelete;
            if (type === 'object') {
                objects = objects.filter(obj => obj.id !== objectId);
                renderObjects();
            } else if (type === 'log') {
                const object = objects.find(obj => obj.id === objectId);
                if (object) {
                    object.logs = object.logs.filter(log => log.logId !== logId);
                    viewReport(objectId); // 모달 내용 새로고침
                }
            }
            itemToDelete = { type: null, objectId: null, logId: null };
            closeModal('deleteConfirmModal');
        }

        // --- 날짜 업데이트 함수 ---
        function updateBriefingDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}`;
            document.getElementById('briefing-date').textContent = `보안 브리핑: ${formattedDate}`;
        }

        // --- 초기화 및 이벤트 리스너 ---
        document.querySelectorAll('a[href^="#"]').forEach(a => a.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
        }));
        
        window.onload = function() {
            renderObjects();
            updateBriefingDate();
        };
    </script>
</body>
</html>

